<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Animation Planning Drawing Tool</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        const Icons = {
          Pencil: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z" /></svg>,
          Brush: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m9.06 11.9 8.07-8.06a2.85 2.85 0 1 1 4.03 4.03l-8.06 8.08" /><path d="M7.07 14.94c-1.66 0-3 1.35-3 3.02 0 1.33-2.5 1.52-2 2.02 1.08 1.1 2.49 2.02 4 2.02 2.2 0 4-1.8 4-4.04a3.01 3.01 0 0 0-3-3.02z" /></svg>,
          Eraser: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.5L13 21" /><path d="M22 21H7" /></svg>,
          Square: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect width="18" height="18" x="3" y="3" rx="2" /></svg>,
          Circle: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10" /></svg>,
          Line: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M5 12h14" /></svg>,
          Type: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="4 7 4 4 20 4 20 7" /><line x1="9" x2="15" y1="20" y2="20" /><line x1="12" x2="12" y1="4" y2="20" /></svg>,
          Grid: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect width="18" height="18" x="3" y="3" rx="2" /><path d="M3 9h18" /><path d="M3 15h18" /><path d="M9 3v18" /><path d="M15 3v18" /></svg>,
          Undo: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 7v6h6" /><path d="M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13" /></svg>,
          Redo: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 7v6h-6" /><path d="M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7" /></svg>,
          Trash: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 6h18" /><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" /><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" /></svg>,
          Download: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="7 10 12 15 17 10" /><line x1="12" x2="12" y1="15" y2="3" /></svg>,
        };

        function AnimationDrawingTool() {
          const canvasRef = useRef(null);
          const [isDrawing, setIsDrawing] = useState(false);
          const [tool, setTool] = useState('pencil');
          const [color, setColor] = useState('#000000');
          const [strokeWidth, setStrokeWidth] = useState(2);
          const [showGrid, setShowGrid] = useState(false);
          const [history, setHistory] = useState([]);
          const [historyStep, setHistoryStep] = useState(-1);
          const [startPos, setStartPos] = useState(null);
          const [isAddingText, setIsAddingText] = useState(false);
          const [textInput, setTextInput] = useState('');
          const [textPosition, setTextPosition] = useState(null);

          useEffect(() => {
            const canvas = canvasRef.current;
            if (canvas) {
              canvas.width = 800;
              canvas.height = 600;
              const ctx = canvas.getContext('2d');
              ctx.fillStyle = 'white';
              ctx.fillRect(0, 0, canvas.width, canvas.height);
              saveToHistory();
            }
          }, []);

          const saveToHistory = () => {
            const canvas = canvasRef.current;
            const newHistory = history.slice(0, historyStep + 1);
            newHistory.push(canvas.toDataURL());
            setHistory(newHistory);
            setHistoryStep(newHistory.length - 1);
          };

          const undo = () => {
            if (historyStep > 0) {
              const canvas = canvasRef.current;
              const ctx = canvas.getContext('2d');
              const img = new Image();
              img.src = history[historyStep - 1];
              img.onload = () => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(img, 0, 0);
                setHistoryStep(historyStep - 1);
              };
            }
          };

          const redo = () => {
            if (historyStep < history.length - 1) {
              const canvas = canvasRef.current;
              const ctx = canvas.getContext('2d');
              const img = new Image();
              img.src = history[historyStep + 1];
              img.onload = () => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(img, 0, 0);
                setHistoryStep(historyStep + 1);
              };
            }
          };

          const clearCanvas = () => {
            const canvas = canvasRef.current;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            saveToHistory();
          };

          const startDrawing = (e) => {
            const canvas = canvasRef.current;
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            if (tool === 'text') {
              setTextPosition({ x, y });
              setIsAddingText(true);
              return;
            }

            setIsDrawing(true);
            setStartPos({ x, y });

            const ctx = canvas.getContext('2d');
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';

            if (tool === 'pencil' || tool === 'brush' || tool === 'eraser') {
              ctx.beginPath();
              ctx.moveTo(x, y);
            }
          };

          const draw = (e) => {
            if (!isDrawing) return;

            const canvas = canvasRef.current;
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            const ctx = canvas.getContext('2d');

            if (tool === 'pencil' || tool === 'brush') {
              ctx.strokeStyle = color;
              ctx.lineWidth = tool === 'brush' ? strokeWidth * 2 : strokeWidth;
              ctx.lineTo(x, y);
              ctx.stroke();
            } else if (tool === 'eraser') {
              ctx.strokeStyle = 'white';
              ctx.lineWidth = strokeWidth * 3;
              ctx.lineTo(x, y);
              ctx.stroke();
            }
          };

          const stopDrawing = (e) => {
            if (!isDrawing) return;

            const canvas = canvasRef.current;
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            const ctx = canvas.getContext('2d');

            if (tool === 'rectangle') {
              ctx.strokeStyle = color;
              ctx.lineWidth = strokeWidth;
              ctx.strokeRect(startPos.x, startPos.y, x - startPos.x, y - startPos.y);
            } else if (tool === 'circle') {
              const radius = Math.sqrt(Math.pow(x - startPos.x, 2) + Math.pow(y - startPos.y, 2));
              ctx.strokeStyle = color;
              ctx.lineWidth = strokeWidth;
              ctx.beginPath();
              ctx.arc(startPos.x, startPos.y, radius, 0, 2 * Math.PI);
              ctx.stroke();
            } else if (tool === 'line') {
              ctx.strokeStyle = color;
              ctx.lineWidth = strokeWidth;
              ctx.beginPath();
              ctx.moveTo(startPos.x, startPos.y);
              ctx.lineTo(x, y);
              ctx.stroke();
            }

            setIsDrawing(false);
            saveToHistory();
          };

          const addText = () => {
            if (textInput.trim() === '') return;

            const canvas = canvasRef.current;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = color;
            ctx.font = '16px Arial';
            ctx.fillText(textInput, textPosition.x, textPosition.y);

            setTextInput('');
            setIsAddingText(false);
            setTextPosition(null);
            saveToHistory();
          };

          const exportImage = (format) => {
            const canvas = canvasRef.current;
            if (!canvas) return;
            
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = canvas.width;
            tempCanvas.height = canvas.height;
            const tempCtx = tempCanvas.getContext('2d');
            
            tempCtx.fillStyle = 'white';
            tempCtx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
            tempCtx.drawImage(canvas, 0, 0);
            
            const mimeType = format === 'png' ? 'image/png' : 'image/jpeg';
            const dataUrl = tempCanvas.toDataURL(mimeType, 1.0);
            
            const link = document.createElement('a');
            link.download = `animation-planning.${format}`;
            link.href = dataUrl;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
          };

          const drawGrid = () => {
            if (!showGrid) return;

            const canvas = canvasRef.current;
            const ctx = canvas.getContext('2d');
            const gridSize = 50;

            ctx.strokeStyle = '#e0e0e0';
            ctx.lineWidth = 1;

            for (let x = 0; x <= canvas.width; x += gridSize) {
              ctx.beginPath();
              ctx.moveTo(x, 0);
              ctx.lineTo(x, canvas.height);
              ctx.stroke();
            }

            for (let y = 0; y <= canvas.height; y += gridSize) {
              ctx.beginPath();
              ctx.moveTo(0, y);
              ctx.lineTo(canvas.width, y);
              ctx.stroke();
            }
          };

          useEffect(() => {
            const canvas = canvasRef.current;
            if (!canvas) return;

            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = canvas.width;
            tempCanvas.height = canvas.height;
            const tempCtx = tempCanvas.getContext('2d');
            tempCtx.drawImage(canvas, 0, 0);

            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(tempCanvas, 0, 0);
            drawGrid();
          }, [showGrid]);

          return (
            <div className="min-h-screen bg-gradient-to-br from-blue-50 to-green-50 p-8">
              <div className="max-w-6xl mx-auto">
                <div className="bg-white rounded-2xl shadow-xl p-6">
                  <h1 className="text-3xl font-bold mb-6 text-center" style={{ color: '#002F6C' }}>
                    Animation Planning Drawing Tool
                  </h1>

                  <div className="mb-6 space-y-4">
                    <div className="flex flex-wrap gap-2 justify-center items-center pb-4 border-b">
                      <button onClick={() => setTool('pencil')} className={`p-3 rounded-lg transition-all ${tool === 'pencil' ? 'shadow-md scale-105' : 'hover:scale-105'}`} style={{ backgroundColor: tool === 'pencil' ? '#002F6C' : '#f3f4f6', color: tool === 'pencil' ? 'white' : '#002F6C' }} title="Pencil">
                        <Icons.Pencil />
                      </button>
                      <button onClick={() => setTool('brush')} className={`p-3 rounded-lg transition-all ${tool === 'brush' ? 'shadow-md scale-105' : 'hover:scale-105'}`} style={{ backgroundColor: tool === 'brush' ? '#002F6C' : '#f3f4f6', color: tool === 'brush' ? 'white' : '#002F6C' }} title="Brush">
                        <Icons.Brush />
                      </button>
                      <button onClick={() => setTool('eraser')} className={`p-3 rounded-lg transition-all ${tool === 'eraser' ? 'shadow-md scale-105' : 'hover:scale-105'}`} style={{ backgroundColor: tool === 'eraser' ? '#002F6C' : '#f3f4f6', color: tool === 'eraser' ? 'white' : '#002F6C' }} title="Eraser">
                        <Icons.Eraser />
                      </button>
                      <div className="w-px h-8 bg-gray-300 mx-2"></div>
                      <button onClick={() => setTool('rectangle')} className={`p-3 rounded-lg transition-all ${tool === 'rectangle' ? 'shadow-md scale-105' : 'hover:scale-105'}`} style={{ backgroundColor: tool === 'rectangle' ? '#00833F' : '#f3f4f6', color: tool === 'rectangle' ? 'white' : '#00833F' }} title="Rectangle">
                        <Icons.Square />
                      </button>
                      <button onClick={() => setTool('circle')} className={`p-3 rounded-lg transition-all ${tool === 'circle' ? 'shadow-md scale-105' : 'hover:scale-105'}`} style={{ backgroundColor: tool === 'circle' ? '#00833F' : '#f3f4f6', color: tool === 'circle' ? 'white' : '#00833F' }} title="Circle">
                        <Icons.Circle />
                      </button>
                      <button onClick={() => setTool('line')} className={`p-3 rounded-lg transition-all ${tool === 'line' ? 'shadow-md scale-105' : 'hover:scale-105'}`} style={{ backgroundColor: tool === 'line' ? '#00833F' : '#f3f4f6', color: tool === 'line' ? 'white' : '#00833F' }} title="Line">
                        <Icons.Line />
                      </button>
                      <button onClick={() => setTool('text')} className={`p-3 rounded-lg transition-all ${tool === 'text' ? 'shadow-md scale-105' : 'hover:scale-105'}`} style={{ backgroundColor: tool === 'text' ? '#00833F' : '#f3f4f6', color: tool === 'text' ? 'white' : '#00833F' }} title="Text">
                        <Icons.Type />
                      </button>
                    </div>

                    <div className="flex flex-wrap gap-4 justify-center items-center">
                      <div className="flex items-center gap-2">
                        <label className="text-sm font-medium" style={{ color: '#002F6C' }}>Color:</label>
                        <input type="color" value={color} onChange={(e) => setColor(e.target.value)} className="w-12 h-10 rounded-lg cursor-pointer border-2" style={{ borderColor: '#002F6C' }} />
                      </div>

                      <div className="flex items-center gap-2">
                        <label className="text-sm font-medium" style={{ color: '#002F6C' }}>Width:</label>
                        <input type="range" min="1" max="20" value={strokeWidth} onChange={(e) => setStrokeWidth(Number(e.target.value))} className="w-32" />
                        <span className="text-sm font-medium w-8" style={{ color: '#002F6C' }}>{strokeWidth}</span>
                      </div>

                      <div className="w-px h-8 bg-gray-300"></div>

                      <button onClick={() => setShowGrid(!showGrid)} className={`p-2 rounded-lg transition-all ${showGrid ? 'shadow-md' : 'hover:scale-105'}`} style={{ backgroundColor: showGrid ? '#00833F' : '#f3f4f6', color: showGrid ? 'white' : '#00833F' }} title="Toggle Grid">
                        <Icons.Grid />
                      </button>

                      <button onClick={undo} disabled={historyStep <= 0} className="p-2 rounded-lg hover:scale-105 transition-all disabled:opacity-30" style={{ backgroundColor: '#f3f4f6', color: '#002F6C' }} title="Undo">
                        <Icons.Undo />
                      </button>

                      <button onClick={redo} disabled={historyStep >= history.length - 1} className="p-2 rounded-lg hover:scale-105 transition-all disabled:opacity-30" style={{ backgroundColor: '#f3f4f6', color: '#002F6C' }} title="Redo">
                        <Icons.Redo />
                      </button>

                      <button onClick={clearCanvas} className="p-2 rounded-lg hover:scale-105 transition-all" style={{ backgroundColor: '#f3f4f6', color: '#002F6C' }} title="Clear Canvas">
                        <Icons.Trash />
                      </button>

                      <div className="w-px h-8 bg-gray-300"></div>

                      <button onClick={() => exportImage('png')} className="px-4 py-2 rounded-lg font-medium hover:scale-105 transition-all flex items-center gap-2" style={{ backgroundColor: '#002F6C', color: 'white' }}>
                        <Icons.Download />
                        PNG
                      </button>

                      <button onClick={() => exportImage('jpeg')} className="px-4 py-2 rounded-lg font-medium hover:scale-105 transition-all flex items-center gap-2" style={{ backgroundColor: '#00833F', color: 'white' }}>
                        <Icons.Download />
                        JPG
                      </button>
                    </div>
                  </div>

                  <div className="flex justify-center">
                    <div className="relative rounded-lg overflow-hidden shadow-lg" style={{ border: '3px solid #002F6C' }}>
                      <canvas ref={canvasRef} onMouseDown={startDrawing} onMouseMove={draw} onMouseUp={stopDrawing} onMouseLeave={stopDrawing} className="cursor-crosshair bg-white" />
                    </div>
                  </div>

                  {isAddingText && (
                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                      <div className="bg-white p-6 rounded-xl shadow-2xl">
                        <h3 className="text-lg font-bold mb-4" style={{ color: '#002F6C' }}>Add Text</h3>
                        <input type="text" value={textInput} onChange={(e) => setTextInput(e.target.value)} onKeyPress={(e) => e.key === 'Enter' && addText()} placeholder="Enter your text..." className="w-64 px-4 py-2 border-2 rounded-lg mb-4" style={{ borderColor: '#002F6C' }} autoFocus />
                        <div className="flex gap-2">
                          <button onClick={addText} className="px-4 py-2 rounded-lg font-medium" style={{ backgroundColor: '#00833F', color: 'white' }}>Add</button>
                          <button onClick={() => { setIsAddingText(false); setTextInput(''); setTextPosition(null); }} className="px-4 py-2 rounded-lg font-medium" style={{ backgroundColor: '#f3f4f6', color: '#002F6C' }}>Cancel</button>
                        </div>
                      </div>
                    </div>
                  )}
                </div>
              </div>
            </div>
          );
        }

        ReactDOM.render(<AnimationDrawingTool />, document.getElementById('root'));
    </script>
</body>
</html>
